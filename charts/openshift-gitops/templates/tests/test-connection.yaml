apiVersion: v1
kind: Pod
metadata:
  name: "{{ include "openshift-gitops.fullname" . }}-test-connection"
  namespace: {{ include "openshift-gitops.argocdNamespace" . }}
  labels:
    {{- include "openshift-gitops.labels" . | nindent 4 }}
    app.kubernetes.io/component: test
  annotations:
    "helm.sh/hook": test
    "helm.sh/hook-delete-policy": before-hook-creation,hook-succeeded
spec:
  containers:
    - name: wget
      image: busybox:latest
      command: ['sh', '-c']
      args:
        - |
          echo "Testing ArgoCD server connection..."
          # Wait for service to be available
          timeout 60 sh -c 'until nc -z {{ include "openshift-gitops.fullname" . }}-server 80; do sleep 2; done'
          
          # Test HTTP connection
          wget --spider --timeout=10 http://{{ include "openshift-gitops.fullname" . }}-server:80/healthz || exit 1
          
          echo "âœ“ ArgoCD server is accessible"
          exit 0
  restartPolicy: Never
